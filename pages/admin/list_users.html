<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Usuarios - Hotel el Rincón del Carmen</title>
    <link rel="stylesheet" href="../../styles/main.css">
    <style>
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: var(--spacing-lg);
      }
      
      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
      }
      
      #usersTable {
        width: 100%;
        border-collapse: collapse;
        background: var(--color-surface);
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow-md);
      }
      
      #usersTable th,
      #usersTable td {
        padding: var(--spacing-sm);
        text-align: left;
        border-bottom: 1px solid var(--color-border);
      }
      
      #usersTable th {
        background: var(--color-primary);
        color: white;
        font-weight: 600;
      }
      
      #usersTable tbody tr:hover {
        background: var(--color-background);
      }
      
      #usersTable td {
        color: var(--color-text);
      }
      
      .access-denied {
        background: var(--color-surface);
        padding: var(--spacing-xl);
        border-radius: var(--radius-lg);
        text-align: center;
        margin-top: var(--spacing-xl);
      }
      
      .access-denied h2 {
        color: var(--color-error);
        margin-bottom: var(--spacing-md);
      }
    </style>
</head>
<body>
  <div class="container">
    <div id="accessCheck">
      <div class="access-denied">
        <h2>Verificando permisos...</h2>
      </div>
    </div>
    
    <div id="usersList" style="display: none;">
      <div class="page-header">
        <h2>Lista de Usuarios</h2>
        <a href="../admin.html" class="btn btn-primary">Volver al Panel Admin</a>
      </div>
      
      <table id="usersTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Documento</th>
            <th>Nombre completo</th>
            <th>Nacionalidad</th>
            <th>Email</th>
            <th>Teléfono</th>
            <th>Rol</th>
            <th>Fecha de creación</th>
          </tr>
        </thead>
        <tbody>
          <!-- Aquí se llenará con JS -->
        </tbody>
      </table>
    </div>
  </div>

  <script type="module">
    const auth = {
      getCurrentUser() {
        const userStr = localStorage.getItem('hotel_current_user');
        return userStr ? JSON.parse(userStr) : null;
      },
      isAdmin() {
        const user = this.getCurrentUser();
        return user && user.role === 'admin';
      }
    };
    
    const db = {
      getUsers() {
        return JSON.parse(localStorage.getItem("hotel_users") || "[]")
      }
    };
    
    // Check if user is admin
    if (!auth.isAdmin()) {
      document.getElementById('accessCheck').innerHTML = `
        <div class="access-denied">
          <h2>Acceso Denegado</h2>
          <p>No tienes permisos para acceder a esta página</p>
          <a href="../admin.html" class="btn btn-primary">Volver al Panel Admin</a>
        </div>
      `;
    } else {
      document.getElementById('accessCheck').style.display = 'none';
      document.getElementById('usersList').style.display = 'block';
      
      // Load users
      const users = db.getUsers();
      const tbody = document.querySelector("#usersTable tbody");

      tbody.innerHTML = "";

      users.forEach((user) => {
        const row = document.createElement("tr");

        row.innerHTML = `
          <td>${user.id}</td>
          <td>${user.documentId}</td>
          <td>${user.fullName}</td>
          <td>${user.nationality}</td>
          <td>${user.email}</td>
          <td>${user.phone}</td>
          <td>${user.role}</td>
          <td>${new Date(user.createdAt).toLocaleString()}</td>
        `;

        tbody.appendChild(row);
      });
    }
  </script>
</body>
</html>
